# 输入 URL 到页面展示过程

首先，需要认知以下浏览器各进程的职责：
- 浏览器进程，负责用户交互、子进程管理和文件存储等功能
- 网络进程，面向渲染进程和浏览器进程等提供网络下载功能
- 渲染进程，将从网络中下载的 HTML、JavaScript、Css、图片等资源解析为可以显示和交互的页面（需要注意的是渲染进程是运行在安全沙箱，因为渲染进程的内容是通过网络获取的，会存在恶意代码利用浏览器漏洞对系统进行攻击）

整体过程：
- 浏览器进程接受到用户输入的 URL 请求，浏览器进程将该 URL 转发给网络进程
- 网络进程中发起真正的 URL 请求
- 网络进程接收到了响应头数据，便解析响应头部数据，将数据转发给浏览器进程
- 浏览器进程接收到网络进程的响应头数据之后，发送**提交导航**消息到渲染进程
- 渲染进程接收到**提交导航**的消息后，便开始准备接收 HTML 数据，接收数据的方式是直接和网络进程建立数据管道
- 渲染进程会向浏览器进程**确认提交**，即告知浏览器进程：“已准备好接受和解析页面数据”
- 浏览器进程接收到渲染进程**提交文档**的消息后，开始移除之前旧的文档，然后更新浏览器进程中的页面状态

## 用户输入

浏览器地址栏对用户输入做了两类判断：
- 如果是搜索内容，会使用浏览器默认的搜索引擎，组合该搜索关键字成 URL 来进行搜索
- 如果是 URL，未完整的 URL 会组合成完整的 URL

>并且值得一提的是，当前页面即将关闭要被替换成新的页面时，浏览器还针对这个时机提供了 beforeunload 事件，例如常见的提示用户是否要离开当前页面

## URL 请求过程

浏览器进程通过进程间通信 IPC 把 URL 请求发送到网络进程，网络进程对该 URL 进行请求。

URL 请求过程：
- 询问浏览器本地缓存，如果存在缓存资源，那么直接返回资源给浏览器进程
- 不存在缓存资源，则进入 HTTP 请求过程

HTTP 请求过程：
- DNS 域名解析，获取对应域名的服务器 IP 地址（当然，如果是 HTTPS 还需要建立 SSL 或 TLS 连接）
- 利用 IP 地址和服务器建立 TCP 连接（即三次握手过程）
- 浏览器端通过请求报文发送给服务器
- 服务器端接收到请求报文后，解析请求报文，发送响应报文给浏览器网络进程
- 浏览器网络进程接收了响应报文后，开始解析响应报文。如果此时状态码为 3xx，网络进程则会根据响应报文中的 Location 字段读取重定向的 URL，重新发起新的 HTTP 或 HTTPS 请求（这也是为什么我们通常遇到重定向的时候，会在 NetWork 中看到两个请求的情况）
- 网络进程在解析响应报文的时候，会通过 Content-Type 响应首部字段的值进行不同的操作，例如 Content-Type 为 text/html，则会交给渲染进程来处理
- 接下来是创建渲染进程，通常每一个页面对应一个渲染进程，但是如果不同页面同属于同一个站点的话则会共用一个渲染进程。
- 创建好渲染进程后，网络进程则会接收到的 HTML 数据给渲染进程，在接收完 HTML 数据后，渲染进程会发送消息给浏览器进程，浏览器进程收到后会更新安全状态、地址栏 URL、前进后退的历史状态以及更新 Web 页面

## 更新 Web 页面





