# TCP 和 UDP

首先我们来认识一下网络中数据的传递过程（值得一提的是，数据的传输过程都会被分为很多小的数据包进行传递）：

数据包结构：
数据 + IP 头（包括 IP 版本、源 IP 地址、目标 IP 地址、生存时间）

>需要注意的是 IP 头是在网络层完成添加的

网络分层：

1.应用层，HTTP 客户端、服务端

2.传输层，UDP、TCP 传输协议

3.网络层，IP 协议

4.链路层

## UDP

使用 UDP 传输的数据包结构：
数据 + UDP 头 + IP 头

UDP（User Datagram Protocol）用户数据包协议，是用于应用层和传输层通信。UDP 中一个最重要的信息是端口号，即指定数据包要发送的应用程序（因为应用程序都会监听指定的端口）。

缺点：
- 数据包在传输过程中容易丢失
- 大文件会被拆分成很多小的数据包来传输，而它们会通过不同的路由，在不同的事件到达接收端，且 UDP 不知道如何组装这些数据包成一个完整的文件。

## TCP

TCP（Transmission Control Protocol，传输控制协议）是一种面向连接的、可靠的、基于字节流的传输层通信协议。

使用 TCP 传输的数据包结构：
数据 + TCP 头 + IP 头

相对于 UDP，TCP 的优点：
- 对于数据包丢失的情况，TCP 提供重传机制
- TCP 引入数据包排序机制，用来保证把乱序的数据包组合成一个完整的文件

### TCP 建立连接过程：

1.建立连接，即**三次握手过程**
- 客户端发送标有 SYN 的数据包，表示我将要发送请求。
- 服务端发送标有 SYN/ACK 的数据包，表示我已经收到通知，告知客户端发送请求。
- 客户端发送标有 ACK 的数据包，表示我要开始发送请求，准备被接受。

2.数据传输
- 服务端接收到数据包，并发送确认数据包已收到的消息到客户端，不断重复这个过程
- 客户端在发送一个数据包后，未接收到服务端的确定消息，则重新发送该数据包，即 TCP 的重发机制
- 当接收完所有的数据包后，接收端会按照 TCP 头中的需要进行排序，形成完整的数据

3.断开连接，即**四次握手过程**
- 客户端发送请求，申请断开连接，进入等待阶段，此时不会发送数据，但是会继续接收数据。
- 服务端接收请求后，告知客户端已明白，此时服务端进入等待状态，不会再接收数据，但是会继续发送数据。
- 客户端收到后，进入下一阶段等待。
- 服务端发送完剩余的数据后，告知客户端可以断开连接，此时服务端不会发送和接收数据。
- 客户端收到后，告知服务端我开始断开连接。
- 服务端收到后，开始断开连接。

