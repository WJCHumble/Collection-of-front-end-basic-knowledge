## HTTP/0.9

HTTP/0.9 于 1991 年提出，当时主要用于传输 HTML 超文本内容，所以已被称为超文本传输协议。

请求过程：
- TCP 三次握手，建立 TCP 连接
- 发送 GET 请求
- 服务器接收请求信息之后，读取对应的 HTML 文件，一 ASCII 字符串流返回给客户端
- 传输完成，断开链接

特点：
- 请求报文首部只有请求行，没有报文首部和报文主体
- 没有响应报文，只需要返回数据
- 数据的传输是 ASCII 字符流

缺点：
- 只能传输 HTML，不能传输其他文件类型
- 只支持 GET 请求，请求方法太过单一
- 文件编码格式单一，只有 ASCII 编码
- 只是简单的 Response 和 Request，无法处理复杂的请求情况，例如重定向、错误情况

## HTTP/1.0

针对 HTTP/0.9 存在的问题，HTTP/1.0 做了很多完善。

特点:
- 增加了响应报文和请求报文
- 对于响应报文增加了状态码
- 增加了强缓存和协商缓存，Expires 和 Last-Modified
- 增加了用户代理字段，统计客户端信息

## HTTP/1.1

特点：
- 增加长连接 Connection: keep-alive，即支持复用 TCP 连接（目前同一个域名可以同时建立 6 个长连接）
- 增加了 HTTP pipeline，即管线化，一个请求不用等待另一个请求回来再发送，可以一起发送。
- 增加了 HOST 请求首部字段，来提供对多个虚拟主机的支持
- 增加了 chunk transfer 的方式，来进行分块传输
- 引入 Cookie，解决无状态的问题
- 增加了 Accept 系列请求首部字段，来支持多种文件类型的传输
- 增加了多种请求方法，POST、PUT、Delete 等
- 针对跨域资源共享，增加请求方法 Option

长连接造成队头阻塞问题的解决方案：
- 引入管线化的请求方式
- 可以多个虚拟主机的方式，即多个域名，并发多个长连接

HTTP/1.1 存在问题：

1.对带宽的利用率却不理想

>带宽：指每秒最大能发送或接收的字节数
上行带宽：每秒能发送的最大字节数
下行带宽：每秒能够接收的最大字节数

原因：

- TCP 的慢启动，TCP 建立连接后，进入发送数据状态，由于它发送数据的过程是一个由慢到快的过程，所以，在刚建立连接时，数据的传输是字符串慢的。而，慢启动是为了避免网络拥塞的情况出现的，所以无法避免。
- 多个 TCP 连接间会竞争固定的带宽，由于带宽有限，所以当每条 TCP 连接都达到一速度时，如果此时带宽不足时，各个 TCP 连接就需要动态减慢传输数据的速度。所以，不能确保关键资源的优先下载
- 队头阻塞，即同一时刻一个 TCP 连接中，只能同时处理一个请求，在当前请求没有结束前，其他请求只能处于阻塞状态

## HTTP/2

多路复用优点：

- 即一个域名只使用一个 TCP 连接来传输数据，整个过程只需要一次慢启动，并且避免了多个 TCP 连接竞争带宽。
- 将数据分成一帧一帧地去传输，可以暂停之前请求，优先处理关键资源

多路复用实现：

**HTTP/2 协议栈**:

- HTTP/2
- 二进制分帧层，将数据经过**二进制分帧层处理**，转换位一个个带有请求 ID 编号的帧，将帧发送给服务器
- TLS（可选）
- TCP
- IP

其他优点：
- Hack 算法压缩头部
- 关键资源优先处理
- 服务端 Cache

## HTTP/3

HTTP/3 同样是对 HTTP/2 做了一些优化，那么我们先看看 HTTP/2 存在的问题：

1.**TCP 队头阻塞**

需要注意的是，HTTP/2 解决的是**应用层**的队头阻塞问题。但是，如果在数据传输过程中，有一个数据因为网络故障或者其他原因而丢包，TCP 连接会暂停，TCP 连接会等待这个数据包重发，所以仍然会造成阻塞的情况。

TCP 队头阻塞：即单个数据包的丢失而造成的阻塞 TCP 上的阻塞

2.**TCP 网络时延（Round Trip Time）**

网络时延：即一个数据包到服务器，再从服务器返回数据包到浏览器的整个往返的时间

>所以，如果只是 `TCP` 是 1.5 个 RTT，当然如果是 HTTPS，还需要 `TLS`（大致需要 1-2 个 RTT），即 HTTP 是 1.5 个 RTT，HTTPS 是 3-4 个 RTT

所以，如果客户端和服务器物理位置较近时，一个 RTT 会是 10ms 以下，那么 HTTPS 就是 30-40 ms。但是，如果物理位置较远的话，一个 RTT 将会是 100ms 以上，那么此时 HTTPS 则需要 300ms-400ms，这个时候用户就可以明显感知到。

3.**TCP 协议僵化**

TCP 协议僵持化，即指难以升级 TCP 协议。首先是中间设备的僵化，由于每个数据包的传输过程会经过很多中间设备，而如果中间存在 TCP 协议并没有升级的设备，那么这个数据包将是不可识别的，即会被丢弃掉。并且，TCP 协议的实现是计算机系统，而计算机系统的更新往往是滞后于应用的更新。

这样一分析，大家会发现，存在的诸多问题都是 TCP 协议的问题。所以，HTTP/3 基于 UDP 实现了一套可以多路复用、可靠性传输的机制，即 QUIC 协议。QUIC 协议实现了以下功能：
- 实现了流量控制、传输可靠性功能，它在 UDP 的基础上增加了一层来保证数据可靠性传输，并且也提供了数据重发、拥塞控制、数据排序等功能- 集成 TLS 加密功能，采用 TLS1.3，减少握手的 RTT 个数
- 实现 HTTP/2 的多路复用功能，不仅仅是复用 TCP 连接，而且在一个连接中分多个数据流，避免 TCP 队头阻塞
- 实现快速握手，即只需要 1RTT 或 0 RTT 就可以建立连接。
